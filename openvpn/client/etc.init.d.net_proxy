#!/bin/bash

start(){
    echo "Start firewall"
    /sbin/depmod -a
    /sbin/modprobe ip_tables
    /sbin/modprobe ip_conntrack
    /sbin/modprobe iptable_filter
    /sbin/modprobe iptable_mangle
    /sbin/modprobe iptable_nat
    /sbin/modprobe ipt_LOG
    /sbin/modprobe ipt_limit
    /sbin/modprobe ipt_state
    echo "1" > /proc/sys/net/ipv4/ip_forward

#    iptables -t nat -A POSTROUTING -s 172.16.55.72 -o eth0 -j SNAT --to 172.16.55.91
#    iptables -t nat -A POSTROUTING -s 172.16.55.0/24 -o eth0 -j SNAT --to 172.16.55.91
#     iptables -t nat -A POSTROUTING -s 172.16.0.0/16 -d 192.168.9.0/24 -o eth0 -j SNAT --to 192.168.9.195
     iptables -t nat -A POSTROUTING -s 172.16.0.0/16 -o eth0 -j SNAT --to 192.168.9.195

     iptables -t nat -A POSTROUTING -s 192.168.9.0/24 -d 172.16.56.0/24 -o tap0 -j SNAT --to 172.16.56.3

     iptables -t nat -A POSTROUTING -s 192.168.9.0/24 -d 172.16.58.0/24 -o tap1 -j SNAT --to 172.16.58.3

	 ip route add 172.16.56.0/24 via 172.16.56.1
	 ip route add 172.16.58.0/24 via 172.16.58.1
	 /usr/local/bin/vpn_check.sh &
	 /usr/local/bin/vpn2_check.sh &
}
stop(){
    echo "Stop firewall"
}
status(){
    clear
    echo "-------------------------------------------------------------------"
    iptables -L
    echo "-------------------------------------------------------------------"
    iptables -t nat -L POSTROUTING
    echo "-------------------------------------------------------------------"
    iptables -t nat -L PREROUTING
}
case "$1" in
start)
        start
;;
stop)
        stop
;;
status)
        status
;;
restart)
        stop
        start
;;
*)
        echo "$0 [start|stop|restart|status]"
;;
esac

